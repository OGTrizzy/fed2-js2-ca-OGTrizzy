import{a as l}from"./read-bhRdoN4k.js";import{h as c,A as i}from"./style-BWM6gi-O.js";import{a as u}from"./authGuard-DDO8JLiG.js";async function p(e,o){const r=`https://v2.api.noroff.dev/social/posts/${e}`;try{const t=localStorage.getItem("accessToken");if(!t)throw new Error("User is not authenticated");const s=c();s.append("Authorization",`Bearer ${t}`);const a=await fetch(r,{method:"PUT",headers:s,body:JSON.stringify(o)});if(!a.ok){const d=await a.json().catch(()=>({errors:[{message:"Unexpected error occurred"}]}));throw console.error("Error details:",d),new Error(d.errors[0]?.message||"Failed to update post")}return await a.json()}catch(t){throw console.error("Error in updatePost:",t.message),t}}async function m(e,o){e.preventDefault();const r={title:document.getElementById("post-title").value,body:document.getElementById("post-body").value,tags:document.getElementById("post-tags").value.split(",").map(t=>t.trim())};try{await p(o,r),alert("Post updated successfully!"),window.location.href=`/post/?id=${o}`}catch(t){console.error("Error updating post:",t),alert("Failed to update post: "+t.message)}}async function h(e){try{const o=localStorage.getItem("accessToken");if(!o)throw new Error("User is not authenticated");const r=c();r.append("Authorization",`Bearer ${o}`);const t=await fetch(`${i}/${e}`,{method:"DELETE",headers:r});if(!t.ok){const s=await t.json();throw new Error(`Failed to delete post: ${s.errors[0].message}`)}alert("Post deleted successfully!"),window.location.href="/"}catch(o){console.error("Error deleting post:",o),alert("Failed to delete post: "+o.message)}}u();const f=new URLSearchParams(window.location.search),n=f.get("id");async function g(){try{const e=await l(n);if(e)document.getElementById("post-title").value=e.title,document.getElementById("post-body").value=e.body,document.getElementById("post-tags").value=e.tags.join(", ");else throw new Error("Post not found")}catch(e){console.error(e),document.getElementById("posts-container").innerText="Failed to load post."}}document.addEventListener("DOMContentLoaded",g);document.getElementById("delete-button").addEventListener("click",async()=>{try{await h(n),alert("Post deleted successfully!"),window.location.href="/"}catch(e){console.error("Error deleting post:",e),alert("Failed to delete post: "+e.message)}});document.getElementById("edit-post-form").addEventListener("submit",e=>{m(e,n)});
